---
import { generateXorKey, obfuscate } from './obfuscate';
import { Type } from './Type';

interface Props {
  /** Obfuscated data */
  data: string,
  /** Obfuscated text, if different from data */
  text?: string
  /** Data type */
  type: Type
}

const { data, text, type } = Astro.props;

const xor = generateXorKey();
const obfuscatedData = obfuscate(data, xor);
const obfuscatedText = text ? obfuscate(text, xor) : null;

const NO_JS_TEXTS: { [key in Type]: string } = {
  [Type.EMAIL]: 'email address',
  [Type.PHONE]: 'phone number',
  [Type.TEXT]: 'text'
}
---

<obfuscated-data
  data-obfuscated={obfuscatedData}
  data-text={obfuscatedText}
  data-xor={xor}
  data-type={type}
>[please wait]</obfuscated-data>

<noscript>
  <span>[enable JavaScript to view this {NO_JS_TEXTS[type]}]</span>
  <style>
    obfuscated-data {
      display: none;
    }
  </style>
</noscript>

<script>
  import ObfuscatedData from './ObfuscatedData';
  customElements.define('obfuscated-data', ObfuscatedData);
</script>
